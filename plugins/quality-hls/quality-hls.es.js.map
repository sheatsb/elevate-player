{"version":3,"file":"quality-hls.es.js","sources":["../../../source/Utils/Log.js","../../../source/Plugin/QualityHls/QualityHlsSettingItem.js"],"sourcesContent":["import videojs from 'video.js';\n\nlet logType = '';\n\ntry {\n  logType = localStorage && localStorage.getItem('vjs-plus-log');\n} catch (e) {}\n\nconst log = (function() {\n  if (logType === 'normal' || videojs.browser.IE_VERSION) {\n    // log without style\n    return console.info.bind(console, '[VJS Plus]:');\n  } else if (logType) {\n    // log with style\n    return console.info.bind(console, '%c[VJS Plus]:', 'font-weight: bold; color:#2196F3;');\n  }\n\n  return function() {};\n})();\n\nexport default log;\n","import videojs from 'video.js';\nimport log from '../../Utils/Log';\n\nconst SettingOptionItem = videojs.getComponent('SettingOptionItem');\n\nclass QualityHlsSettingItem extends SettingOptionItem {\n  constructor(player, options) {\n    super(player, {\n      ...options,\n      name: 'QualityHlsSettingItem',\n      label: 'Quality',\n      icon: 'vjs-icon-hd'\n    });\n\n    this.addClass('vjs-setting-quality');\n\n    this.levels = [];\n\n    this.handleAllLevelsAdded();\n  }\n\n  handleAllLevelsAdded() {\n    const player = this.player_;\n\n    if (!player.qualityLevels) {\n      log('plugin videojs-contrib-quality-levels do not exsits');\n\n      return false;\n    }\n\n    const qualityLevels = player.qualityLevels();\n    let levels = [];\n    let timeout;\n\n    qualityLevels.on('addqualitylevel', ({ qualityLevel }) => {\n      clearTimeout(timeout);\n\n      levels.push(qualityLevel);\n\n      const callback = () => {\n        this.levels = levels.slice(0);\n\n        player.trigger('before-quality-setup', {\n          levels: this.levels\n        });\n\n        this.onAllLevelsAdded();\n\n        levels = [];\n      };\n\n      timeout = setTimeout(callback, 10);\n    });\n  }\n\n  onAllLevelsAdded() {\n    const entries = [\n      ...this.levels\n        .map(({ height }) => {\n          return {\n            label: this.localize(`${height}p`),\n            value: height,\n            default: false\n          };\n        })\n        .sort((a, b) => {\n          return b.value - a.value;\n        }),\n      {\n        label: 'Auto',\n        value: 'auto',\n        default: true\n      }\n    ];\n\n    if (this.levels.length > 1) {\n      // use auto as default\n      this.setEntries(entries, entries.length - 1);\n\n      this.show();\n\n      this.player_.trigger('hls-quality', this.levels);\n    } else {\n      this.hide();\n    }\n  }\n\n  onChange(selected) {\n    const { value } = selected;\n\n    super.onChange(selected);\n\n    this.levels.forEach(lv => {\n      lv.enabled = lv.height === value || value === 'auto';\n    });\n\n    this.player_.trigger(\n      'hls-qualitychange',\n      this.entries.reduce((acc, entry, index) => {\n        if (entry.value === value) {\n          const level = this.levels.find(v => v.height === value) || {};\n\n          acc = {\n            index,\n            level,\n            ...entry\n          };\n        }\n\n        return acc;\n      }, {})\n    );\n  }\n}\n\nvideojs\n  .getComponent('SettingMenuButton')\n  .prototype.options_.entries.push('QualityHlsSettingItem');\n\nvideojs.registerComponent('QualityHlsSettingItem', QualityHlsSettingItem);\n\nexport default QualityHlsSettingItem;\n"],"names":["logType","localStorage","getItem","e","log","videojs","browser","IE_VERSION","console","info","bind","SettingOptionItem","getComponent","QualityHlsSettingItem","player","options","name","label","icon","addClass","levels","handleAllLevelsAdded","player_","qualityLevels","timeout","on","qualityLevel","clearTimeout","push","callback","slice","trigger","onAllLevelsAdded","setTimeout","entries","map","height","localize","value","sort","a","b","length","setEntries","show","hide","onChange","selected","forEach","lv","enabled","reduce","acc","entry","index","level","find","v","prototype","options_","registerComponent"],"mappings":"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"}